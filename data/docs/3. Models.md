---
title: "Регрессионный анализ"
author: "Евгений Бердинских, Марина Козырева, Антон Тихоненко, Олеся Цветкова"
date: "2024-12-16"
output: 
  html_document:
    keep_md: true
---



## Загрузка данных для анализа


``` r
brain_data <- read_csv("data/raw/brain_data.csv") %>%
   mutate(across(c(Month, Year, Sud_Imp, Sud_Storm), as.factor),
          Dst_level = factor(Dst_level, 
                             levels = c("Quiet", "Weak", "Moderate", "Major", "Severe"),
                             ordered = TRUE))
```


## Моделирование


``` r
model_poisson <- glm(EMS ~ Date + Temp_mean + Sunspots + Dst_mean + Dst_var,
                     data = brain_data, family = poisson)
summary(model_poisson)
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_mean + 
##     Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.229e+00  4.107e-02 -29.917  < 2e-16 ***
## Date         2.253e-04  2.374e-06  94.899  < 2e-16 ***
## Temp_mean   -9.885e-04  2.730e-04  -3.621 0.000293 ***
## Sunspots     2.624e-04  8.653e-05   3.032 0.002428 ** 
## Dst_mean    -4.856e-04  3.158e-04  -1.538 0.124167    
## Dst_var     -2.682e-04  2.699e-04  -0.994 0.320379    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8996.3  on 5731  degrees of freedom
## AIC: 33271
## 
## Number of Fisher Scoring iterations: 4
```

``` r
dispersiontest(model_poisson)
```

```
## 
## 	Overdispersion test
## 
## data:  model_poisson
## z = 18.666, p-value < 2.2e-16
## alternative hypothesis: true dispersion is greater than 1
## sample estimates:
## dispersion 
##   1.544587
```

``` r
model_NBR <- glm.nb(EMS ~ Date + Temp_mean + Sunspots + Dst_mean + Dst_var,
                    data = brain_data, link = "log")
summary(model_NBR)
```

```
## 
## Call:
## glm.nb(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_mean + 
##     Dst_var, data = brain_data, link = "log", init.theta = 23.72861894)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.371e+00  5.008e-02 -27.374  < 2e-16 ***
## Date         2.333e-04  2.931e-06  79.593  < 2e-16 ***
## Temp_mean   -1.133e-03  3.423e-04  -3.308 0.000939 ***
## Sunspots     4.606e-04  1.071e-04   4.299 1.72e-05 ***
## Dst_mean    -3.932e-04  3.938e-04  -0.998 0.318060    
## Dst_var     -1.825e-04  3.375e-04  -0.541 0.588751    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Negative Binomial(23.7286) family taken to be 1)
## 
##     Null deviance: 12463.1  on 5736  degrees of freedom
## Residual deviance:  6020.7  on 5731  degrees of freedom
## AIC: 32666
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  23.73 
##           Std. Err.:  1.31 
## 
##  2 x log-likelihood:  -32651.99
```
## Параметры модели


``` r
#Пуассон
tidy(model_poisson, conf.level = 0.95, conf.int = TRUE) %>%
  # filter(p.value < 0.05) %>% 
  mutate(
    model = "Poisson",  
    EMS_effect = ifelse(
    term != "(Intercept)",
    paste0(signif((exp(estimate) - 1) * 100, 3), "%"),
    signif((exp(estimate)), 3))) -> Poisson_data

#Пуассон с коррекцией гетероскедастичности
bind_cols(
  tidy(coeftest(model_poisson, vcov. = vcovHC(model_poisson, type = "HC3"))),
  coefci(model_poisson, vcov. = vcovHC(model_poisson, type = "HC3")) %>% 
    as_tibble() %>% rename(conf.low = "2.5 %", conf.high = "97.5 %")
  ) %>%
  # filter(p.value < 0.05) %>% 
  mutate(
    model = "Poisson_vcovHC", 
    EMS_effect = ifelse(
    term != "(Intercept)",
    paste0(signif((exp(estimate) - 1) * 100, 3), "%"),
    signif((exp(estimate)), 3))) -> Poisson_vcovHC_data

#Отрицательное биномиальное распределение
tidy(model_NBR, conf.level = 0.95, conf.int = TRUE) %>% 
  # filter(p.value < 0.05) %>% 
  mutate(
    model = "Neg_binomial", 
    EMS_effect = ifelse(
    term != "(Intercept)",
    paste0(signif((exp(estimate) - 1) * 100, 3), "%"),
    signif((exp(estimate)), 3))) -> Neg_binomial_data


bind_rows(Poisson_data, Poisson_vcovHC_data, Neg_binomial_data) %>% 
  arrange(term)
```

```
## # A tibble: 18 × 9
##    term         estimate  std.error statistic   p.value   conf.low conf.high model          EMS_effect
##    <chr>           <dbl>      <dbl>     <dbl>     <dbl>      <dbl>     <dbl> <chr>          <chr>     
##  1 (Intercept) -1.23     0.0411       -29.9   1.18e-196 -1.31      -1.15     Poisson        0.293     
##  2 (Intercept) -1.23     0.0506       -24.3   2.85e-130 -1.33      -1.13     Poisson_vcovHC 0.293     
##  3 (Intercept) -1.37     0.0501       -27.4   5.60e-165 -1.47      -1.27     Neg_binomial   0.254     
##  4 Date         0.000225 0.00000237    94.9   0          0.000221   0.000230 Poisson        0.0225%   
##  5 Date         0.000225 0.00000294    76.7   0          0.000220   0.000231 Poisson_vcovHC 0.0225%   
##  6 Date         0.000233 0.00000293    79.6   0          0.000227   0.000239 Neg_binomial   0.0233%   
##  7 Dst_mean    -0.000486 0.000316      -1.54  1.24e-  1 -0.00110    0.000134 Poisson        -0.0485%  
##  8 Dst_mean    -0.000486 0.000402      -1.21  2.27e-  1 -0.00127    0.000302 Poisson_vcovHC -0.0485%  
##  9 Dst_mean    -0.000393 0.000394      -0.998 3.18e-  1 -0.00116    0.000377 Neg_binomial   -0.0393%  
## 10 Dst_var     -0.000268 0.000270      -0.994 3.20e-  1 -0.000799   0.000259 Poisson        -0.0268%  
## 11 Dst_var     -0.000268 0.000349      -0.768 4.43e-  1 -0.000953   0.000417 Poisson_vcovHC -0.0268%  
## 12 Dst_var     -0.000182 0.000337      -0.541 5.89e-  1 -0.000844   0.000477 Neg_binomial   -0.0182%  
## 13 Sunspots     0.000262 0.0000865      3.03  2.43e-  3  0.0000926  0.000432 Poisson        0.0262%   
## 14 Sunspots     0.000262 0.000108       2.44  1.48e-  2  0.0000515  0.000473 Poisson_vcovHC 0.0262%   
## 15 Sunspots     0.000461 0.000107       4.30  1.72e-  5  0.000250   0.000670 Neg_binomial   0.0461%   
## 16 Temp_mean   -0.000989 0.000273      -3.62  2.93e-  4 -0.00152   -0.000453 Poisson        -0.0988%  
## 17 Temp_mean   -0.000989 0.000341      -2.90  3.77e-  3 -0.00166   -0.000320 Poisson_vcovHC -0.0988%  
## 18 Temp_mean   -0.00113  0.000342      -3.31  9.39e-  4 -0.00180   -0.000461 Neg_binomial   -0.113%
```

## Диагностика моделей

``` r
# Регрессия Пуассона
plot(model_poisson)
```

![](data/pics/figure-plots-1.png)<!-- -->![](data/pics/figure-plots-2.png)<!-- -->![](data/pics/figure-plots-3.png)<!-- -->![](data/pics/figure-plots-4.png)<!-- -->

``` r
crPlots(model_poisson)
```

![](data/pics/figure-plots-5.png)<!-- -->

``` r
#  Отрицательное биномиальное распределение
plot(model_NBR)
```

![](data/pics/figure-plots-6.png)<!-- -->![](data/pics/figure-plots-7.png)<!-- -->![](data/pics/figure-plots-8.png)<!-- -->![](data/pics/figure-plots-9.png)<!-- -->

``` r
crPlots(model_NBR)
```

![](data/pics/figure-plots-10.png)<!-- -->


## Сравнение моделей

``` r
bind_rows(Poisson_data, Poisson_vcovHC_data, Neg_binomial_data) %>% 
  filter(term != "(Intercept)") %>%
  ggplot(aes(x = term,y = estimate, ymin = conf.low, ymax = conf.high, colour = model))+
  geom_pointrange(position = position_dodge(width = 0.6)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") + 
  coord_flip() + 
  labs( x = "", y = "Оценка коэффициена", title = "Сравнение моделей") +
  theme_custom
```

![](data/pics/figure-compare-1.png)<!-- -->


## Преобразование Dst

``` r
glm(EMS ~ Date + Temp_mean + Sunspots + Dst_mean + Dst_var,
                     data = brain_data, family = poisson) %>% 
  summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_mean + 
##     Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.229e+00  4.107e-02 -29.917  < 2e-16 ***
## Date         2.253e-04  2.374e-06  94.899  < 2e-16 ***
## Temp_mean   -9.885e-04  2.730e-04  -3.621 0.000293 ***
## Sunspots     2.624e-04  8.653e-05   3.032 0.002428 ** 
## Dst_mean    -4.856e-04  3.158e-04  -1.538 0.124167    
## Dst_var     -2.682e-04  2.699e-04  -0.994 0.320379    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8996.3  on 5731  degrees of freedom
## AIC: 33271
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Date + Temp_mean + Sunspots + Dst_PC1 + Dst_PC2,
                     data = brain_data, family = poisson) %>% 
  summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_PC1 + Dst_PC2, 
##     family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.227e+00  4.087e-02 -30.021  < 2e-16 ***
## Date         2.252e-04  2.369e-06  95.023  < 2e-16 ***
## Temp_mean   -9.982e-04  2.729e-04  -3.658 0.000254 ***
## Sunspots     2.526e-04  8.596e-05   2.938 0.003303 ** 
## Dst_PC1     -1.051e-03  8.829e-04  -1.190 0.233904    
## Dst_PC2     -1.061e-03  2.218e-03  -0.479 0.632204    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8997.2  on 5731  degrees of freedom
## AIC: 33272
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Date + Temp_mean + Sunspots + Dst_level,
                     data = brain_data, family = poisson) %>% 
  summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_level, 
##     family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.188e+00  4.637e-02 -25.609  < 2e-16 ***
## Date         2.251e-04  2.367e-06  95.095  < 2e-16 ***
## Temp_mean   -1.010e-03  2.728e-04  -3.702 0.000214 ***
## Sunspots     2.729e-04  8.646e-05   3.157 0.001597 ** 
## Dst_level.L  1.157e-01  6.522e-02   1.773 0.076160 .  
## Dst_level.Q  8.439e-02  5.579e-02   1.513 0.130362    
## Dst_level.C  3.636e-02  4.611e-02   0.788 0.430446    
## Dst_level^4  2.577e-02  3.021e-02   0.853 0.393717    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8992.9  on 5729  degrees of freedom
## AIC: 33272
## 
## Number of Fisher Scoring iterations: 4
```
## Преобразование Sunspot

``` r
glm(EMS ~ Date + Temp_mean + Sunspots + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_mean + 
##     Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.229e+00  4.107e-02 -29.917  < 2e-16 ***
## Date         2.253e-04  2.374e-06  94.899  < 2e-16 ***
## Temp_mean   -9.885e-04  2.730e-04  -3.621 0.000293 ***
## Sunspots     2.624e-04  8.653e-05   3.032 0.002428 ** 
## Dst_mean    -4.856e-04  3.158e-04  -1.538 0.124167    
## Dst_var     -2.682e-04  2.699e-04  -0.994 0.320379    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8996.3  on 5731  degrees of freedom
## AIC: 33271
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Date + Temp_mean + I(lag(Sunspots, 1)) + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + I(lag(Sunspots, 1)) + 
##     Dst_mean + Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##                       Estimate Std. Error z value Pr(>|z|)    
## (Intercept)         -1.227e+00  4.107e-02 -29.867  < 2e-16 ***
## Date                 2.252e-04  2.374e-06  94.844  < 2e-16 ***
## Temp_mean           -9.915e-04  2.730e-04  -3.632 0.000281 ***
## I(lag(Sunspots, 1))  2.499e-04  8.667e-05   2.883 0.003942 ** 
## Dst_mean            -4.878e-04  3.160e-04  -1.544 0.122690    
## Dst_var             -2.574e-04  2.698e-04  -0.954 0.340015    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18514  on 5735  degrees of freedom
## Residual deviance:  8995  on 5730  degrees of freedom
##   (1 observation deleted due to missingness)
## AIC: 33267
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Date + Temp_mean + I(lag(Sunspots, 2)) + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + I(lag(Sunspots, 2)) + 
##     Dst_mean + Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##                       Estimate Std. Error z value Pr(>|z|)    
## (Intercept)         -1.227e+00  4.108e-02 -29.875  < 2e-16 ***
## Date                 2.252e-04  2.375e-06  94.821  < 2e-16 ***
## Temp_mean           -9.964e-04  2.730e-04  -3.650 0.000262 ***
## I(lag(Sunspots, 2))  2.659e-04  8.681e-05   3.064 0.002186 ** 
## Dst_mean            -4.807e-04  3.162e-04  -1.520 0.128413    
## Dst_var             -2.670e-04  2.699e-04  -0.989 0.322501    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18505.8  on 5734  degrees of freedom
## Residual deviance:  8992.9  on 5729  degrees of freedom
##   (2 observations deleted due to missingness)
## AIC: 33262
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Date + Temp_mean + I(lag(Sunspots, 3)) + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + I(lag(Sunspots, 3)) + 
##     Dst_mean + Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##                       Estimate Std. Error z value Pr(>|z|)    
## (Intercept)         -1.224e+00  4.108e-02 -29.797  < 2e-16 ***
## Date                 2.251e-04  2.375e-06  94.760  < 2e-16 ***
## Temp_mean           -1.001e-03  2.730e-04  -3.667 0.000246 ***
## I(lag(Sunspots, 3))  2.420e-04  8.699e-05   2.782 0.005406 ** 
## Dst_mean            -4.811e-04  3.165e-04  -1.520 0.128402    
## Dst_var             -2.592e-04  2.698e-04  -0.960 0.336805    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18495.3  on 5733  degrees of freedom
## Residual deviance:  8992.4  on 5728  degrees of freedom
##   (3 observations deleted due to missingness)
## AIC: 33258
## 
## Number of Fisher Scoring iterations: 4
```

``` r
acf(brain_data$Sunspots)
```

![](data/pics/figure-Sunspot-1.png)<!-- -->

``` r
glm(EMS ~ Date + Temp_mean + I(rollmean(Sunspots, 7, fill = NA)) + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + I(rollmean(Sunspots, 7, 
##     fill = NA)) + Dst_mean + Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##                                       Estimate Std. Error z value Pr(>|z|)    
## (Intercept)                         -1.233e+00  4.121e-02 -29.919  < 2e-16 ***
## Date                                 2.255e-04  2.380e-06  94.768  < 2e-16 ***
## Temp_mean                           -9.670e-04  2.732e-04  -3.540  0.00040 ***
## I(rollmean(Sunspots, 7, fill = NA))  2.803e-04  9.101e-05   3.080  0.00207 ** 
## Dst_mean                            -5.207e-04  3.160e-04  -1.648  0.09934 .  
## Dst_var                             -2.923e-04  2.702e-04  -1.082  0.27933    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18495  on 5730  degrees of freedom
## Residual deviance:  8977  on 5725  degrees of freedom
##   (6 observations deleted due to missingness)
## AIC: 33229
## 
## Number of Fisher Scoring iterations: 4
```


## Сезонная цикличность

``` r
brain_data %>%
  transmute(
    Date,
    cos_month = cospi(as.numeric(format(Date, "%m")) / 12)
  ) %>%
  ggplot() +
  geom_line(aes(x = Date, y = cos_month), color = "skyblue") + 
  theme_custom
```

![](data/pics/figure-period-1.png)<!-- -->

``` r
glm(EMS ~ Date + Temp_mean + Sunspots + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + Temp_mean + Sunspots + Dst_mean + 
##     Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept) -1.229e+00  4.107e-02 -29.917  < 2e-16 ***
## Date         2.253e-04  2.374e-06  94.899  < 2e-16 ***
## Temp_mean   -9.885e-04  2.730e-04  -3.621 0.000293 ***
## Sunspots     2.624e-04  8.653e-05   3.032 0.002428 ** 
## Dst_mean    -4.856e-04  3.158e-04  -1.538 0.124167    
## Dst_var     -2.682e-04  2.699e-04  -0.994 0.320379    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8996.3  on 5731  degrees of freedom
## AIC: 33271
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Month + Temp_mean + Sunspots + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Month + Temp_mean + Sunspots + Dst_mean + 
##     Dst_var, family = poisson, data = brain_data)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(>|z|)    
## (Intercept)  2.674e+00  1.885e-02 141.828  < 2e-16 ***
## Month2      -2.533e-02  1.831e-02  -1.383  0.16653    
## Month3      -8.174e-02  2.013e-02  -4.061 4.88e-05 ***
## Month4      -1.797e-01  2.436e-02  -7.377 1.62e-13 ***
## Month5      -2.106e-01  2.746e-02  -7.668 1.75e-14 ***
## Month6      -2.563e-01  3.140e-02  -8.161 3.33e-16 ***
## Month7      -3.059e-01  3.279e-02  -9.329  < 2e-16 ***
## Month8      -2.792e-01  3.132e-02  -8.912  < 2e-16 ***
## Month9      -2.613e-01  2.762e-02  -9.462  < 2e-16 ***
## Month10     -2.032e-01  2.355e-02  -8.626  < 2e-16 ***
## Month11     -9.489e-02  1.977e-02  -4.799 1.60e-06 ***
## Month12     -3.751e-02  1.793e-02  -2.092  0.03647 *  
## Temp_mean    7.368e-03  7.557e-04   9.749  < 2e-16 ***
## Sunspots    -3.591e-04  8.548e-05  -4.201 2.65e-05 ***
## Dst_mean     9.353e-04  3.174e-04   2.947  0.00321 ** 
## Dst_var      1.392e-03  2.618e-04   5.316 1.06e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524  on 5736  degrees of freedom
## Residual deviance: 18352  on 5721  degrees of freedom
## AIC: 42647
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ I(cospi(as.numeric(format(Date, "%m")) / 12)) + Temp_mean + Sunspots + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ I(cospi(as.numeric(format(Date, "%m"))/12)) + 
##     Temp_mean + Sunspots + Dst_mean + Dst_var, family = poisson, 
##     data = brain_data)
## 
## Coefficients:
##                                               Estimate Std. Error z value Pr(>|z|)    
## (Intercept)                                  2.528e+00  6.784e-03 372.597  < 2e-16 ***
## I(cospi(as.numeric(format(Date, "%m"))/12))  2.492e-02  5.495e-03   4.535 5.76e-06 ***
## Temp_mean                                    7.019e-04  2.798e-04   2.509  0.01212 *  
## Sunspots                                    -3.588e-04  8.536e-05  -4.204 2.62e-05 ***
## Dst_mean                                     8.957e-04  3.127e-04   2.865  0.00417 ** 
## Dst_var                                      1.317e-03  2.621e-04   5.026 5.01e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524  on 5736  degrees of freedom
## Residual deviance: 18458  on 5731  degrees of freedom
## AIC: 42733
## 
## Number of Fisher Scoring iterations: 4
```

``` r
glm(EMS ~ Date + I(cospi(as.numeric(format(Date, "%m")) / 12)) + Temp_mean + Sunspots + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + I(cospi(as.numeric(format(Date, "%m"))/12)) + 
##     Temp_mean + Sunspots + Dst_mean + Dst_var, family = poisson, 
##     data = brain_data)
## 
## Coefficients:
##                                               Estimate Std. Error z value Pr(>|z|)    
## (Intercept)                                 -1.225e+00  4.107e-02 -29.832  < 2e-16 ***
## Date                                         2.252e-04  2.374e-06  94.859  < 2e-16 ***
## I(cospi(as.numeric(format(Date, "%m"))/12))  1.993e-02  5.475e-03   3.640 0.000272 ***
## Temp_mean                                   -7.552e-04  2.806e-04  -2.691 0.007119 ** 
## Sunspots                                     2.645e-04  8.656e-05   3.055 0.002247 ** 
## Dst_mean                                    -5.439e-04  3.163e-04  -1.720 0.085508 .  
## Dst_var                                     -3.199e-04  2.704e-04  -1.183 0.236787    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8983.1  on 5730  degrees of freedom
## AIC: 33260
## 
## Number of Fisher Scoring iterations: 4
```

``` r
brain_data %>%
  transmute(
    Date,
    cos_day = cospi(as.numeric(format(Date, "%j")) / 365)
  ) %>% ggplot()+
  geom_line(aes(Date, cos_day), colour = "skyblue")+
  theme_custom
```

![](data/pics/figure-period-2.png)<!-- -->

``` r
glm(EMS ~ Date + I(cospi(as.numeric(format(Date, "%j")) / 365)) + Temp_mean + Sunspots + Dst_mean + Dst_var, 
    data = brain_data, family = poisson) %>% summary()
```

```
## 
## Call:
## glm(formula = EMS ~ Date + I(cospi(as.numeric(format(Date, "%j"))/365)) + 
##     Temp_mean + Sunspots + Dst_mean + Dst_var, family = poisson, 
##     data = brain_data)
## 
## Coefficients:
##                                                Estimate Std. Error z value Pr(>|z|)    
## (Intercept)                                  -1.227e+00  4.106e-02 -29.879  < 2e-16 ***
## Date                                          2.252e-04  2.374e-06  94.864  < 2e-16 ***
## I(cospi(as.numeric(format(Date, "%j"))/365))  1.862e-02  5.369e-03   3.468 0.000524 ***
## Temp_mean                                    -8.192e-04  2.774e-04  -2.953 0.003151 ** 
## Sunspots                                      2.639e-04  8.655e-05   3.049 0.002295 ** 
## Dst_mean                                     -5.396e-04  3.163e-04  -1.706 0.087998 .  
## Dst_var                                      -3.181e-04  2.704e-04  -1.176 0.239483    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 18524.4  on 5736  degrees of freedom
## Residual deviance:  8984.3  on 5730  degrees of freedom
## AIC: 33261
## 
## Number of Fisher Scoring iterations: 4
```

